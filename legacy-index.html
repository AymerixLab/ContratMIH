<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrat de participation MIH 2026</title>
  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
  <!-- Bibliothèque jsPDF pour la génération du devis PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Bibliothèque JSZip pour regrouper plusieurs fichiers PDF dans une archive zip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <!-- Plugin AutoTable pour jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <form id="contractForm">
    <!-- En-tête de l’événement -->
    <header>
      <div class="event-info">
        <h1>Salon Made in Hainaut 2026</h1>
        <p>Site minier d’Arenberg – La Porte du Hainaut</p>
        <p>21 & 22 mai 2026</p>
      </div>
      <div class="logo">
        <!-- Vous pouvez remplacer ce texte par un logo en ajoutant une image ici -->
        Le Salon Made in Hainaut
      </div>
    </header>

    <!-- Section identité -->
    <section id="identite" class="section">
      <h2>Votre identité</h2>
      <div class="field-group">
        <label for="raisonSociale">Raison sociale :</label>
        <input type="text" id="raisonSociale" required>
      </div>
      <div class="field-group">
        <label for="adresse">Adresse :</label>
        <input type="text" id="adresse" required>
      </div>
      <div class="field-group">
        <label for="codePostal">Code postal :</label>
        <input type="text" id="codePostal" required>
      </div>
      <div class="field-group">
        <label for="ville">Ville :</label>
        <input type="text" id="ville" required>
      </div>
      <div class="field-group">
        <label for="pays">Pays :</label>
        <input type="text" id="pays" required>
      </div>
      <div class="field-group">
        <label for="telephone">Tél :</label>
        <input type="text" id="telephone">
      </div>
      <div class="field-group">
        <label for="fax">Fax :</label>
        <input type="text" id="fax">
      </div>
      <div class="field-group">
        <label for="siteInternet">Site internet :</label>
        <input type="text" id="siteInternet">
      </div>
      <div class="field-group">
        <label for="siret">Siret :</label>
        <input type="text" id="siret">
      </div>
      <div class="field-group">
        <label for="tva">TVA intracommunautaire :</label>
        <input type="text" id="tva">
      </div>
      <!-- Adhésion / exposition précédente -->
      <div class="checkbox-group">
        <label><input type="checkbox" id="membrePorte"> Je suis membre de l’association Porte du Hainaut Développement</label>
        <label><input type="checkbox" id="exposant2024"> J’étais exposant en 2024</label>
      </div>
      <!-- Activités -->
      <p style="font-weight:bold;margin-top:10px;">Activité (case à cocher) :</p>
      <div class="checkbox-group">
        <label><input type="checkbox" id="actIndustrie"> Industrie</label>
        <label><input type="checkbox" id="actEnvironnement"> Environnement, énergie et développement durable</label>
        <label><input type="checkbox" id="actTourisme"> Tourisme et bien‑être</label>
        <label><input type="checkbox" id="actTransport"> Transport et logistique</label>
        <label><input type="checkbox" id="actServices"> Services aux entreprises</label>
        <label><input type="checkbox" id="actBTP"> BTP, construction et logement</label>
        <label><input type="checkbox" id="actImage"> Image et nouvelles technologies</label>
        <label><input type="checkbox" id="actAutre"> Autre</label>
      </div>
      <!-- Adresse de facturation -->
      <p style="font-weight:bold;margin-top:10px;">Adresse de facturation (si différente) :</p>
      <div class="field-group">
        <label for="factCodePostal">Code postal :</label>
        <input type="text" id="factCodePostal">
      </div>
      <div class="field-group">
        <label for="factVille">Ville :</label>
        <input type="text" id="factVille">
      </div>
      <div class="field-group">
        <label for="factPays">Pays :</label>
        <input type="text" id="factPays">
      </div>
      <!-- Contact comptabilité -->
      <p style="font-weight:bold;margin-top:10px;">Contact Comptabilité</p>
      <div class="field-group">
        <label for="contactNom">Nom du contact :</label>
        <input type="text" id="contactNom">
      </div>
      <div class="field-group">
        <label for="contactTel">Tél direct :</label>
        <input type="text" id="contactTel">
      </div>
      <div class="field-group">
        <label for="contactMail">Mail :</label>
        <input type="email" id="contactMail">
      </div>
      <!-- Responsable de l’entreprise -->
      <p style="font-weight:bold;margin-top:10px;">Responsable de l’entreprise</p>
      <div class="field-group">
        <label for="respNom">Nom :</label>
        <input type="text" id="respNom">
      </div>
      <div class="field-group">
        <label for="respPrenom">Prénom :</label>
        <input type="text" id="respPrenom">
      </div>
      <div class="field-group">
        <label for="respTel">Tél :</label>
        <input type="text" id="respTel">
      </div>
      <div class="field-group">
        <label for="respMail">Mail :</label>
        <input type="email" id="respMail">
      </div>
      <!-- Responsable opérationnel du stand -->
      <p style="font-weight:bold;margin-top:10px;">Responsable opérationnel du stand</p>
      <div class="field-group">
        <label for="opNom">Nom :</label>
        <input type="text" id="opNom">
      </div>
      <div class="field-group">
        <label for="opPrenom">Prénom :</label>
        <input type="text" id="opPrenom">
      </div>
      <div class="field-group">
        <label for="opTel">Tél :</label>
        <input type="text" id="opTel">
      </div>
      <div class="field-group">
        <label for="opMail">Mail :</label>
        <input type="email" id="opMail">
      </div>
      <!-- Enseigne -->
      <div class="field-group">
        <label for="enseigne">Enseigne (nom du stand) :</label>
        <input type="text" id="enseigne">
      </div>
    </section>

    <!-- Section 1 : Réservation d’espace -->
    <section id="reservation" class="section">
      <h2>1. Réservation d’espace</h2>
      <p><strong>Stand équipé (270 €/m²)</strong></p>
      <table class="tarifs">
        <tr><th>Surface (m²)</th><th>Prix unitaire</th><th>Quantité</th><th>Total HT</th></tr>
        <tr>
          <td>Stand équipé</td>
          <td>270 € / m²</td>
          <td><input type="number" min="0" id="standEquipeSurface" value="0"></td>
          <td class="right" id="tot_standEquipeSurface">0,00 €</td>
        </tr>
        <tr>
          <td>Angles stand équipé</td>
          <td>185 € / angle</td>
          <td><input type="number" min="0" id="standEquipeAngle" value="0"></td>
          <td class="right" id="tot_standEquipeAngle">0,00 €</td>
        </tr>
      </table>

      <p><strong>Pack « Prêt à exposer »</strong></p>
      <table class="tarifs">
        <tr><th>Surface</th><th>Prix unitaire</th><th>Quantité</th><th>Total HT</th></tr>
        <tr>
          <td>12 m²</td>
          <td>3 552 €</td>
          <td><input type="number" min="0" id="pack12" value="0"></td>
          <td class="right" id="tot_pack12">0,00 €</td>
        </tr>
        <tr>
          <td>15 m²</td>
          <td>4 438 €</td>
          <td><input type="number" min="0" id="pack15" value="0"></td>
          <td class="right" id="tot_pack15">0,00 €</td>
        </tr>
        <tr>
          <td>18 m²</td>
          <td>5 326 €</td>
          <td><input type="number" min="0" id="pack18" value="0"></td>
          <td class="right" id="tot_pack18">0,00 €</td>
        </tr>
        <tr>
          <td>Angles pack</td>
          <td>185 € / angle</td>
          <td><input type="number" min="0" id="packAngles" value="0"></td>
          <td class="right" id="tot_packAngles">0,00 €</td>
        </tr>
      </table>

      <p><strong>Stand nu (à partir de 24 m²)</strong></p>
      <table class="tarifs">
        <tr><th>Surface (m²)</th><th>Prix unitaire</th><th>Quantité</th><th>Total HT</th></tr>
        <tr>
          <td>Stand nu</td>
          <td>225 € / m²</td>
          <td><input type="number" min="0" id="standNuSurface" value="0"></td>
          <td class="right" id="tot_standNuSurface">0,00 €</td>
        </tr>
        <tr>
          <td>Angles stand nu</td>
          <td>185 € / angle</td>
          <td><input type="number" min="0" id="standNuAngle" value="0"></td>
          <td class="right" id="tot_standNuAngle">0,00 €</td>
        </tr>
      </table>

      <p><strong>Puissance électrique supérieure</strong></p>
      <div class="field-group">
        <label for="puissance">Coffret électrique :</label>
        <select id="puissance">
          <option value="0">0 € (1 kW de base)</option>
          <option value="220">2 kW – 220 €</option>
          <option value="260">4 kW – 260 €</option>
          <option value="350">6 kW – 350 €</option>
        </select>
      </div>
      <p><strong>Espace d’exposition extérieur</strong></p>
      <table class="tarifs">
        <tr><th>Option</th><th>Prix unitaire</th><th>Quantité</th><th>Total HT</th></tr>
        <tr>
          <td>Surface au sol</td>
          <td>50 € / m²</td>
          <td><input type="number" min="0" id="surfaceExterieur" value="0"></td>
          <td class="right" id="tot_surfaceExterieur">0,00 €</td>
        </tr>
        <tr>
          <td>Garden cottage (3 m × 3 m)</td>
          <td>800 €</td>
          <td><input type="number" min="0" id="cottage" value="0"></td>
          <td class="right" id="tot_cottage">0,00 €</td>
        </tr>
      </table>
      <p><strong>Total HT section 1 :</strong> <span id="totalSection1">0,00 €</span></p>
    </section>

    <!-- Section 2 : Aménagements optionnels -->
    <section id="amenagements" class="section">
      <h2>2. Aménagements optionnels</h2>
      <p><strong>Équipements stands</strong></p>
      <table class="tarifs">
        <tr><th>Libellé</th><th>Prix unitaire</th><th>Quantité</th><th>Total HT</th></tr>
        <tr>
          <td>Réserve 1 m² avec porte (cloisons mélaminées)</td>
          <td>200 €</td>
          <td><input type="number" min="0" id="reserveMelamine" value="0"></td>
          <td class="right" id="tot_reserveMelamine">0,00 €</td>
        </tr>
        <tr>
          <td>Moquette coloris différent</td>
          <td>6,50 € / m²</td>
          <td><input type="number" min="0" id="moquetteDiff" value="0"></td>
          <td class="right" id="tot_moquetteDiff">0,00 €</td>
        </tr>
        <tr>
          <td>Velum (tissu tendu) – au m²</td>
          <td>15 € / m²</td>
          <td><input type="number" min="0" id="velum" value="0"></td>
          <td class="right" id="tot_velum">0,00 €</td>
        </tr>
        <tr>
          <td>Cloison bois gainée tissu – ml</td>
          <td>50 € / ml</td>
          <td><input type="number" min="0" id="cloisonBoisTissu" value="0"></td>
          <td class="right" id="tot_cloisonBoisTissu">0,00 €</td>
        </tr>
        <tr>
          <td>Réserve 1 m² avec porte (cloisons bois)</td>
          <td>260 €</td>
          <td><input type="number" min="0" id="reserveBois" value="0"></td>
          <td class="right" id="tot_reserveBois">0,00 €</td>
        </tr>
        <tr>
          <td>Rail de 3 spots supplémentaires</td>
          <td>45 €</td>
          <td><input type="number" min="0" id="railSpots" value="0"></td>
          <td class="right" id="tot_railSpots">0,00 €</td>
        </tr>
      </table>
      <p><strong>Mobilier</strong></p>
      <table class="tarifs">
        <tr><th>Libellé</th><th>Prix unitaire</th><th>Quantité</th><th>Total HT</th></tr>
        <tr>
          <td>1 comptoir</td><td>165 €</td><td><input type="number" min="0" id="mobilier_comptoir" value="0"></td><td class="right" id="tot_mobilier_comptoir">0,00 €</td>
        </tr>
        <tr>
          <td>1 tabouret</td><td>40 €</td><td><input type="number" min="0" id="mobilier_tabouret" value="0"></td><td class="right" id="tot_mobilier_tabouret">0,00 €</td>
        </tr>
        <tr>
          <td>1 mange‑debout</td><td>90 €</td><td><input type="number" min="0" id="mobilier_mangeDebout" value="0"></td><td class="right" id="tot_mobilier_mangeDebout">0,00 €</td>
        </tr>
        <tr>
          <td>1 chaise</td><td>40 €</td><td><input type="number" min="0" id="mobilier_chaise" value="0"></td><td class="right" id="tot_mobilier_chaise">0,00 €</td>
        </tr>
        <tr>
          <td>1 table 120 × 60 cm</td><td>80 €</td><td><input type="number" min="0" id="mobilier_table120" value="0"></td><td class="right" id="tot_mobilier_table120">0,00 €</td>
        </tr>
        <tr>
          <td>1 mange‑debout + 3 tabourets</td><td>195 €</td><td><input type="number" min="0" id="mobilier_packMangeDebout" value="0"></td><td class="right" id="tot_mobilier_packMangeDebout">0,00 €</td>
        </tr>
        <tr>
          <td>1 écran 52 ″ sur pied (HDMI/VGA)</td><td>395 €</td><td><input type="number" min="0" id="mobilier_ecran52" value="0"></td><td class="right" id="tot_mobilier_ecran52">0,00 €</td>
        </tr>
        <tr>
          <td>1 réfrigérateur 140 L (85×60×60)</td><td>125 €</td><td><input type="number" min="0" id="mobilier_frigo140" value="0"></td><td class="right" id="tot_mobilier_frigo140">0,00 €</td>
        </tr>
        <tr>
          <td>1 réfrigérateur 260 L (140×60×60)</td><td>210 €</td><td><input type="number" min="0" id="mobilier_frigo260" value="0"></td><td class="right" id="tot_mobilier_frigo260">0,00 €</td>
        </tr>
        <tr>
          <td>1 présentoir pour documents A4</td><td>115 €</td><td><input type="number" min="0" id="mobilier_presentoir" value="0"></td><td class="right" id="tot_mobilier_presentoir">0,00 €</td>
        </tr>
        <tr>
          <td>Bandeau signalétique pourtour stand – ml</td><td>35 € / ml</td><td><input type="number" min="0" id="mobilier_bandeau" value="0"></td><td class="right" id="tot_mobilier_bandeau">0,00 €</td>
        </tr>
        <tr>
          <td>Bloc de 3 prises</td><td>18 €</td><td><input type="number" min="0" id="mobilier_blocPrises" value="0"></td><td class="right" id="tot_mobilier_blocPrises">0,00 €</td>
        </tr>
        <tr>
          <td>1 fauteuil</td><td>59 €</td><td><input type="number" min="0" id="mobilier_fauteuil" value="0"></td><td class="right" id="tot_mobilier_fauteuil">0,00 €</td>
        </tr>
        <tr>
          <td>1 table basse ronde (ø 60 cm)</td><td>55 €</td><td><input type="number" min="0" id="mobilier_tableBasse" value="0"></td><td class="right" id="tot_mobilier_tableBasse">0,00 €</td>
        </tr>
        <tr>
          <td>1 guéridon haut 120 cm</td><td>55 €</td><td><input type="number" min="0" id="mobilier_gueridonHaut" value="0"></td><td class="right" id="tot_mobilier_gueridonHaut">0,00 €</td>
        </tr>
        <tr>
          <td>1 pouf cube 40×40×40 cm</td><td>33 €</td><td><input type="number" min="0" id="mobilier_poufCube" value="0"></td><td class="right" id="tot_mobilier_poufCube">0,00 €</td>
        </tr>
        <tr>
          <td>1 colonne vitrine</td><td>252 €</td><td><input type="number" min="0" id="mobilier_colonneVitrine" value="0"></td><td class="right" id="tot_mobilier_colonneVitrine">0,00 €</td>
        </tr>
        <tr>
          <td>1 comptoir vitrine</td><td>271 €</td><td><input type="number" min="0" id="mobilier_comptoirVitrine" value="0"></td><td class="right" id="tot_mobilier_comptoirVitrine">0,00 €</td>
        </tr>
        <tr>
          <td>1 porte‑manteaux sur pied</td><td>51 €</td><td><input type="number" min="0" id="mobilier_porteManteaux" value="0"></td><td class="right" id="tot_mobilier_porteManteaux">0,00 €</td>
        </tr>
        <tr>
          <td>1 plante bambou avec pot blanc</td><td>50 €</td><td><input type="number" min="0" id="mobilier_planteBambou" value="0"></td><td class="right" id="tot_mobilier_planteBambou">0,00 €</td>
        </tr>
        <tr>
          <td>1 plante kentia avec pot blanc</td><td>50 €</td><td><input type="number" min="0" id="mobilier_planteKentia" value="0"></td><td class="right" id="tot_mobilier_planteKentia">0,00 €</td>
        </tr>
      </table>
      <p><strong>Total HT section 2 :</strong> <span id="totalSection2">0,00 €</span></p>
    </section>

    <!-- Section 3 : Produits complémentaires -->
    <section id="produits" class="section">
      <h2>3. Produits complémentaires</h2>
      <table class="tarifs">
        <tr><th>Produit</th><th>Prix unitaire</th><th>Quantité</th><th>Total HT</th></tr>
        <tr>
          <td>Scan badges visiteurs</td><td>150 € / stand</td><td><input type="checkbox" id="scanBadges"></td><td class="right" id="tot_scanBadges">0,00 €</td>
        </tr>
        <tr>
          <td>Pass soirée (50 €/pass)</td><td>50 € / pass</td><td><input type="number" min="0" id="passSoiree" value="0"></td><td class="right" id="tot_passSoiree">0,00 €</td>
        </tr>
      </table>
      <p><strong>Total HT section 3 :</strong> <span id="totalSection3">0,00 €</span></p>
    </section>

    <!-- Section 4 : Visibilité & communication -->
    <section id="communication" class="section">
      <h2>4. Visibilité & communication</h2>
      <p><strong>Signalétique et habillage</strong></p>
      <table class="tarifs">
        <tr><th>Prestation</th><th>Prix unitaire</th><th>Quantité</th><th>Total HT</th></tr>
        <tr>
          <td>Pack signalétique complet</td><td>1 020 €</td><td><input type="number" min="0" id="visu_packComplet" value="0"></td><td class="right" id="tot_visu_packComplet">0,00 €</td>
        </tr>
        <tr>
          <td>Signalétique comptoir</td><td>180 €</td><td><input type="number" min="0" id="visu_comptoir" value="0"></td><td class="right" id="tot_visu_comptoir">0,00 €</td>
        </tr>
        <tr>
          <td>Signalétique haut de cloisons</td><td>435 €</td><td><input type="number" min="0" id="visu_hautCloisons" value="0"></td><td class="right" id="tot_visu_hautCloisons">0,00 €</td>
        </tr>
        <tr>
          <td>Signalétique cloison complète</td><td>185 €</td><td><input type="number" min="0" id="visu_cloisonComplete" value="0"></td><td class="right" id="tot_visu_cloisonComplete">0,00 €</td>
        </tr>
        <tr>
          <td>Signalétique enseigne haute</td><td>180 €</td><td><input type="number" min="0" id="visu_enseigneHaute" value="0"></td><td class="right" id="tot_visu_enseigneHaute">0,00 €</td>
        </tr>
      </table>
      <p><strong>Amélioration de visibilité et communication</strong></p>
      <table class="tarifs">
        <tr><th>Prestation</th><th>Prix unitaire</th><th>Quantité</th><th>Total HT</th></tr>
        <tr>
          <td>500 invitations papier à personnaliser</td><td>100 €</td><td><input type="number" min="0" id="ameli_invitations" value="0"></td><td class="right" id="tot_ameli_invitations">0,00 €</td>
        </tr>
        <tr>
          <td>1/2 page quadri dans le catalogue des exposants</td><td>700 €</td><td><input type="number" min="0" id="ameli_demiPage" value="0"></td><td class="right" id="tot_ameli_demiPage">0,00 €</td>
        </tr>
        <tr>
          <td>1 page quadri dans le catalogue des exposants</td><td>1 200 €</td><td><input type="number" min="0" id="ameli_unePage" value="0"></td><td class="right" id="tot_ameli_unePage">0,00 €</td>
        </tr>
        <tr>
          <td>Deuxième de couverture dans le catalogue</td><td>1 800 €</td><td><input type="number" min="0" id="ameli_deuxiemeCouverture" value="0"></td><td class="right" id="tot_ameli_deuxiemeCouverture">0,00 €</td>
        </tr>
        <tr>
          <td>Quatrième de couverture dans le catalogue</td><td>2 300 €</td><td><input type="number" min="0" id="ameli_quatriemeCouverture" value="0"></td><td class="right" id="tot_ameli_quatriemeCouverture">0,00 €</td>
        </tr>
        <tr>
          <td>Logo sur le plan du salon</td><td>550 €</td><td><input type="number" min="0" id="ameli_logoPlan" value="0"></td><td class="right" id="tot_ameli_logoPlan">0,00 €</td>
        </tr>
        <tr>
          <td>Documentation/Goodies dans sac visiteur</td><td>900 €</td><td><input type="number" min="0" id="ameli_goodies" value="0"></td><td class="right" id="tot_ameli_goodies">0,00 €</td>
        </tr>
        <tr>
          <td>Distribution communication par 1 hôtesse (2 jours)</td><td>1 500 €</td><td><input type="number" min="0" id="ameli_hotesse" value="0"></td><td class="right" id="tot_ameli_hotesse">0,00 €</td>
        </tr>
      </table>
      <p><strong>Total HT section 4 :</strong> <span id="totalSection4">0,00 €</span></p>
    </section>

    <!-- Section Totaux et conditions financières -->
    <section id="totaux" class="section">
      <h2>5. Totaux et conditions financières</h2>
      <div id="totalsDisplay">
        <!-- Les totaux seront injectés ici par JavaScript -->
      </div>
    </section>

    <!-- Engagement contractuel et génération de devis -->
    <section id="engagement" class="section">
      <h2>6. Engagement contractuel</h2>
      <div class="signature-section">
        <label for="nomSignataire">Nom et prénom du représentant :</label>
        <input type="text" id="nomSignataire" required>
      </div>
      <div class="signature-section">
        <label for="dateSignature">Date :</label>
        <input type="date" id="dateSignature" required>
      </div>
      <div class="signature-section consent-group">
        <!-- Case à cocher à gauche de la phrase -->
        <input type="checkbox" id="acceptReglement" style="margin-right:6px;">
        <span id="showConditions" style="color:#007bff; text-decoration:underline; cursor:pointer;">
          J’atteste avoir pris connaissance du règlement et m’engage à le respecter
        </span>
      </div>
    </section>

    <button type="button" id="generatePdf" disabled>Générer le devis PDF</button>
    <!-- Bouton optionnel pour générer le contrat pré-rempli séparément -->
    <button type="button" id="generateContract" disabled>Générer le contrat pré-rempli</button>
    <!-- Modal pour afficher les conditions générales de vente -->
    <div id="conditionsModal">
      <div class="modal-content">
        <h3>Conditions générales de vente</h3>
        <pre id="conditionsText"></pre>
        <button type="button" id="closeConditions">Fermer</button>
      </div>
    </div>
  </form>

  <script>
    // Tarifs unitaires (HT)
    const tarifs = {
      standEquipeSurface: 270,
      standEquipeAngle: 185,
      pack12: 3552,
      pack15: 4438,
      pack18: 5326,
      packAngle: 185,
      standNuSurface: 225,
      standNuAngle: 185,
      puissance: { '0': 0, '220': 220, '260': 260, '350': 350 },
      surfaceExterieur: 50,
      cottage: 800,
      // Équipements stands
      reserveMelamine: 200,
      moquetteDiff: 6.5,
      velum: 15,
      cloisonBoisTissu: 50,
      reserveBois: 260,
      railSpots: 45,
      // Mobilier
      mobilier_comptoir: 165,
      mobilier_tabouret: 40,
      mobilier_mangeDebout: 90,
      mobilier_chaise: 40,
      mobilier_table120: 80,
      mobilier_packMangeDebout: 195,
      mobilier_ecran52: 395,
      mobilier_frigo140: 125,
      mobilier_frigo260: 210,
      mobilier_presentoir: 115,
      mobilier_bandeau: 35,
      mobilier_blocPrises: 18,
      mobilier_fauteuil: 59,
      mobilier_tableBasse: 55,
      mobilier_gueridonHaut: 55,
      mobilier_poufCube: 33,
      mobilier_colonneVitrine: 252,
      mobilier_comptoirVitrine: 271,
      mobilier_porteManteaux: 51,
      mobilier_planteBambou: 50,
      mobilier_planteKentia: 50,
      // Produits complémentaires
      scanBadges: 150,
      passSoiree: 50,
      // Visibilité / signalétique
      visu_packComplet: 1020,
      visu_comptoir: 180,
      visu_hautCloisons: 435,
      visu_cloisonComplete: 185,
      visu_enseigneHaute: 180,
      // Amélioration visibilité
      ameli_invitations: 100,
      ameli_demiPage: 700,
      ameli_unePage: 1200,
      ameli_deuxiemeCouverture: 1800,
      ameli_quatriemeCouverture: 2300,
      ameli_logoPlan: 550,
      ameli_goodies: 900,
      ameli_hotesse: 1500
    };

    // Liste des clés utilisées pour le mobilier et la signalétique. Ces tableaux servent
    // à parcourir dynamiquement les champs sans répéter du code. Ils sont
    // définis ici pour être accessibles dans les différentes fonctions.
    const mobilierKeys = [
      'comptoir','tabouret','mangeDebout','chaise','table120','packMangeDebout','ecran52','frigo140','frigo260','presentoir','bandeau','blocPrises','fauteuil','tableBasse','gueridonHaut','poufCube','colonneVitrine','comptoirVitrine','porteManteaux','planteBambou','planteKentia'
    ];
    const visukeys = ['packComplet','comptoir','hautCloisons','cloisonComplete','enseigneHaute'];
    const amelikeys = ['invitations','demiPage','unePage','deuxiemeCouverture','quatriemeCouverture','logoPlan','goodies','hotesse'];

    /*
     * Gestion du contrat de participation et des conditions générales.
     * Nous chargeons les images des pages du contrat (format PNG) et
     * générons un second PDF en superposant les données saisies sur la
     * première page. Les autres pages sont ajoutées en tant que fonds
     * d’impression. Les positions (en mm) sont approximatives mais
     * permettent d’inscrire les champs dans les zones prévues du PDF.
     */
    const contractPagesPaths = [
      'mih2026_page-1.png',
      'mih2026_page-2.png',
      'mih2026_page-3.png',
      'mih2026_page-4.png',
      'mih2026_page-5.png',
      'mih2026_page-6.png'
    ];
    // Tableau contenant les DataURIs des pages une fois chargées.
    let contractPagesDataUrls = [];
    // Convertit un fichier image en DataURI à l’aide de fetch et FileReader.
    // Cette approche évite les problèmes de CORS pouvant survenir avec Image().
    async function toDataURL(path) {
      const response = await fetch(path);
      const blob = await response.blob();
      return await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = err => reject(err);
        reader.readAsDataURL(blob);
      });
    }
    // Précharge toutes les pages du contrat.
    async function loadContractPages() {
      if (contractPagesDataUrls.length > 0) return;
      for (const p of contractPagesPaths) {
        const dataUrl = await toDataURL(p);
        contractPagesDataUrls.push(dataUrl);
      }
    }
    // Génère le contrat pré-rempli en utilisant jsPDF. Les coordonnées ont
    // été estimées pour placer les réponses au-dessus des lignes pointillées.
    async function generateContractPdf(data) {
      const { jsPDF } = window.jspdf;
      await loadContractPages();
      const doc = new jsPDF({ format: 'a4', unit: 'mm' });
      // Page 1 : arrière-plan + texte
      doc.addImage(contractPagesDataUrls[0], 'JPEG', 0, 0, 210, 297);
      doc.setFontSize(8);
      // Coordonnées des champs de la section identité
      doc.text(data.raisonSociale || '', 50, 125);
      doc.text(data.adresse || '', 50, 130);
      doc.text(data.codePostal || '', 50, 135);
      doc.text(data.ville || '', 80, 135);
      doc.text(data.pays || '', 130, 135);
      doc.text(data.telephone || '', 50, 140);
      doc.text(data.fax || '', 80, 140);
      doc.text(data.siteInternet || '', 130, 140);
      doc.text(data.siret || '', 50, 145);
      doc.text(data.tva || '', 130, 145);
      // Cases à cocher : membre et exposant 2024
      if (data.membrePorte === 'Oui') {
        doc.text('X', 50, 150);
      }
      if (data.exposant2024 === 'Oui') {
        doc.text('X', 130, 150);
      }
      // Activités (X sur les cases correspondantes)
      const acts = data.activites ? data.activites.split(',').map(a => a.trim()) : [];
      if (acts.includes('Industrie')) doc.text('X', 50, 155);
      if (acts.includes('Environnement')) doc.text('X', 50, 159);
      if (acts.includes('Tourisme')) doc.text('X', 50, 163);
      if (acts.includes('Transport')) doc.text('X', 90, 155);
      if (acts.includes('Services')) doc.text('X', 90, 159);
      if (acts.includes('Autre')) doc.text('X', 90, 163);
      if (acts.includes('BTP')) doc.text('X', 140, 155);
      if (acts.includes('Image')) doc.text('X', 140, 159);
      // Adresse de facturation
      doc.text(data.factCodePostal || '', 50, 172);
      doc.text(data.factVille || '', 80, 172);
      doc.text(data.factPays || '', 130, 172);
      // Contact comptabilité
      doc.text(data.contactNom || '', 50, 177);
      doc.text(data.contactTel || '', 90, 177);
      doc.text(data.contactMail || '', 140, 177);
      // Responsable de l’entreprise
      doc.text(data.respNom || '', 50, 186);
      doc.text(data.respPrenom || '', 50, 190);
      doc.text(data.respTel || '', 50, 194);
      doc.text(data.respMail || '', 50, 198);
      // Responsable opérationnel du stand
      doc.text(data.opNom || '', 120, 186);
      doc.text(data.opPrenom || '', 120, 190);
      doc.text(data.opTel || '', 120, 194);
      doc.text(data.opMail || '', 120, 198);
      // Enseigne (nom du stand)
      doc.text(data.enseigne || '', 50, 212);
      // Pages suivantes : on ajoute simplement l’image de fond pour chaque page
      for (let i = 1; i < contractPagesDataUrls.length; i++) {
        doc.addPage();
        doc.addImage(contractPagesDataUrls[i], 'JPEG', 0, 0, 210, 297);
      }
      const contractName = 'Contrat MIH 2026 ' + (data.raisonSociale || '').replace(/\s+/g, '_') + '.pdf';
      doc.save(contractName);
    }

    /**
     * Crée un document de devis PDF sans l'enregistrer.
     * @param {Object} contact Informations générales (raison sociale, date, adresse, etc.)
     * @param {Array} prestations Liste des prestations sélectionnées, avec libelle, qty, unite, pu et total
     * @param {number} totalHT Total hors taxes
     * @param {number} tva Montant de la TVA
     * @param {number} totalTTC Total toutes taxes comprises
     * @param {number} acompte Acompte
     * @param {number} solde Solde à payer
     * @returns {Object} Une instance jsPDF représentant le devis
     */
    async function createQuoteDoc(contact, prestations, totalHT, tva, totalTTC, acompte, solde) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ format: 'a4', unit: 'mm' });
      // Titre et coordonnées
      doc.setFontSize(16);
      doc.text('Devis Salon Made in Hainaut 2026', 10, 15);
      doc.setFontSize(10);
      doc.text(`Date : ${contact.date.split('-').reverse().join('/')}`, 10, 25);
      doc.text(`Raison sociale : ${contact.raisonSociale}`, 10, 30);
      const adresseComplete = `${contact.adresse} ${contact.codePostal} ${contact.ville} ${contact.pays}`.trim();
      doc.text(`Adresse : ${adresseComplete}`, 10, 35);
      if (contact.telephone) doc.text(`Téléphone : ${contact.telephone}`, 10, 40);
      if (contact.email) doc.text(`Email : ${contact.email}`, 10, 45);
      doc.text(`Signataire : ${contact.signataire}`, 10, 50);
      // Tableau des prestations
      const head = [['Libellé', 'Qté', 'Unité', 'PU HT', 'Total HT']];
      const body = prestations.map(item => [
        item.libelle,
        item.qty.toString(),
        item.unite || '',
        formatEuros(item.pu),
        formatEuros(item.total)
      ]);
      doc.autoTable({
        startY: 60,
        head: head,
        body: body,
        headStyles: { fillColor: [200, 200, 200], textColor: 0, halign: 'center' },
        bodyStyles: { halign: 'right' },
        columnStyles: {
          0: { halign: 'left' },
          1: { halign: 'right' },
          2: { halign: 'center' },
          3: { halign: 'right' },
          4: { halign: 'right' }
        }
      });
      // Résumé financier sous le tableau
      let y = doc.lastAutoTable.finalY + 10;
      doc.setFontSize(12);
      doc.text('Résumé financier', 10, y);
      y += 6;
      doc.setFontSize(10);
      doc.text(`Total HT : ${formatEuros(totalHT)}`, 10, y);
      y += 5;
      doc.text(`TVA (20 %) : ${formatEuros(tva)}`, 10, y);
      y += 5;
      doc.text(`Total TTC : ${formatEuros(totalTTC)}`, 10, y);
      y += 5;
      doc.text(`Acompte (50 %) : ${formatEuros(acompte)}`, 10, y);
      y += 5;
      doc.text(`Solde : ${formatEuros(solde)}`, 10, y);
      return doc;
    }

    /**
     * Crée un contrat pré-rempli sous forme de document jsPDF sans l'enregistrer.
     * Utilise les images des pages du contrat comme arrière-plan et remplit la première page.
     * @param {Object} data Toutes les données collectées du formulaire
     * @returns {Object} Instance jsPDF représentant le contrat rempli
     */
    async function createContractDoc(data) {
      const { jsPDF } = window.jspdf;
      await loadContractPages();
      const doc = new jsPDF({ format: 'a4', unit: 'mm' });
      // Page 1
      doc.addImage(contractPagesDataUrls[0], 'JPEG', 0, 0, 210, 297);
      doc.setFontSize(8);
      // Identité
      doc.text(data.raisonSociale || '', 50, 125);
      doc.text(data.adresse || '', 50, 130);
      doc.text(data.codePostal || '', 50, 135);
      doc.text(data.ville || '', 80, 135);
      doc.text(data.pays || '', 130, 135);
      doc.text(data.telephone || '', 50, 140);
      doc.text(data.fax || '', 80, 140);
      doc.text(data.siteInternet || '', 130, 140);
      doc.text(data.siret || '', 50, 145);
      // Insérer le numéro de TVA intracommunautaire
      doc.text(data.tvaNumber || '', 130, 145);
      // Cases à cocher
      if (data.membrePorte === 'Oui') {
        doc.text('X', 50, 150);
      }
      if (data.exposant2024 === 'Oui') {
        doc.text('X', 130, 150);
      }
      const acts = data.activites ? data.activites.split(',').map(a => a.trim()) : [];
      if (acts.includes('Industrie')) doc.text('X', 50, 155);
      if (acts.includes('Environnement')) doc.text('X', 50, 159);
      if (acts.includes('Tourisme')) doc.text('X', 50, 163);
      if (acts.includes('Transport')) doc.text('X', 90, 155);
      if (acts.includes('Services')) doc.text('X', 90, 159);
      if (acts.includes('Autre')) doc.text('X', 90, 163);
      if (acts.includes('BTP')) doc.text('X', 140, 155);
      if (acts.includes('Image')) doc.text('X', 140, 159);
      // Facturation
      doc.text(data.factCodePostal || '', 50, 172);
      doc.text(data.factVille || '', 80, 172);
      doc.text(data.factPays || '', 130, 172);
      // Contact comptabilité
      doc.text(data.contactNom || '', 50, 177);
      doc.text(data.contactTel || '', 90, 177);
      doc.text(data.contactMail || '', 140, 177);
      // Responsable entreprise
      doc.text(data.respNom || '', 50, 186);
      doc.text(data.respPrenom || '', 50, 190);
      doc.text(data.respTel || '', 50, 194);
      doc.text(data.respMail || '', 50, 198);
      // Responsable opérationnel
      doc.text(data.opNom || '', 120, 186);
      doc.text(data.opPrenom || '', 120, 190);
      doc.text(data.opTel || '', 120, 194);
      doc.text(data.opMail || '', 120, 198);
      // Enseigne
      doc.text(data.enseigne || '', 50, 212);
      // Ajouter pages suivantes
      for (let i = 1; i < contractPagesDataUrls.length; i++) {
        doc.addPage();
        doc.addImage(contractPagesDataUrls[i], 'JPEG', 0, 0, 210, 297);
      }
      return doc;
    }
    // Contenu des conditions générales de vente. Ce texte est affiché dans la fenêtre modale lorsqu’on clique sur le texte du règlement.
    const conditionsContent = `1. CONDITIONS GÉNÉRALES DE VENTES
Le présent règlement a pour objet de définir les règles applicables à l’admission et à la participation des exposants à l’édition 2026 du salon Made in Hainaut.
Porte du Hainaut Développement, ci-après désigné « l’Organisateur », se réserve la possibilité de modifier ou de compléter le présent règlement, sans préavis, dans l’intérêt du respect de la sécurité des personnes et des biens. L’Organisateur en informera l’exposant par tous moyens appropriés.

2. PARTICIPATION
Le contrat de participation doit être adressé à Porte du Hainaut Développement « Salon Made in Hainaut », rue Michel Rondet - BP 28 - 59135 WALLERS-ARENBERG et marque l’acceptation pleine et entière de l’exposant au présent règlement.
Seules les demandes entièrement remplies et dûment signées, accompagnées du paiement prévu pourront être prises en considération, sous réserve de l’encaissement complet. Les paiements sont à libeller à l’ordre de « Porte du Hainaut Développement ».

3. CONDITIONS DE RÈGLEMENT
Le paiement de la location doit être fait aux deux échéances ci-après définies. L’exposant doit verser, au moment de sa demande de participation, une première échéance égale à 50 % du montant total TTC de sa réservation. En cas de désistement du fait de l’exposant, ce premier paiement partiel reste définitivement acquis à l’Organisateur. (voir chapitre 4 : défaut d’occupation - annulation). 100 % du montant total TTC du contrat de participation devra être payé le 06 mai 2026 au plus tard. Tout défaut de paiement aux échéances fixées entraîne de plein droit, et sans mise en demeure préalable, des pénalités de retard au taux mensuel égal à deux fois le taux de l’intérêt légal et entraîne le droit pour l’Organisateur d’annuler la mise à disposition du stand et modifier l’emplacement concédé.
Le défaut de paiement du solde de la participation dans le délai fixé donne à l’Organisateur, sans mise en demeure préalable, le droit de retirer l’admission de l’exposant et/ou entraîne la déchéance de l’emplacement de celui-ci. Dans toutes ces hypothèses, le montant total de la facture est dû à l’Organisateur.

4. DÉFAUT D’OCCUPATION – ANNULATION
La signature de la demande de participation constitue un engagement ferme. L’annulation de la participation entraînera le paiement d’une indemnité par l’exposant. L’annulation ne sera prise en compte que si elle est adressée par l’exposant à l’Organisateur par lettre recommandée avec demande d’avis de réception. Si le désistement intervient, par lettre recommandée avec demande d’avis de réception reçue avant le 20 avril 2026, 50 % du montant total de la facture sera dû à titre d’indemnité. Pour toute annulation non reçue dans ces conditions, le règlement complet de la facture restera dû par l’exposant à l’Organisateur. Tout stand non occupé le jour de l’ouverture à 10h sera repris par l’Organisateur, sans que l’exposant ne puisse prétendre à aucune indemnité, même si l’Organisateur a pu relouer l’emplacement initialement réservé.
L’Organisateur se réserve le droit de reporter la manifestation et de changer les horaires indiqués notamment en cas de force majeure ou pour toute autre raison qui nécessiterait une telle modification. Le report de la manifestation ou le changement d’horaires ne peut pas justifier une annulation totale ou partielle de réservation de la part des exposants.

5. AFFECTATION DES STANDS
L’Organisateur est seul juge de l’implantation des stands. Il statue sur les admissions et la répartition des stands, le nombre d’exposants et leur surface sans être obligé de motiver sa décision. La décision d’admission ou de répartition des stands ne pourra donner lieu à une quelconque indemnité. Seule l’émission de la facture de location d’espace par l’Organisateur constitue une preuve de l’admission de l’exposant, sous réserve du complet encaissement. L’Organisateur tiendra notamment compte dans le cadre des attributions de la date de retour des dossiers.

6. OBLIGATIONS DE L’EXPOSANT
Il n’est pas admis qu’un exposant héberge une société non affiliée sur son stand, sans l’accord préalable et écrit de l’Organisateur. Toute admission engage définitivement et irrévocablement son souscripteur qui accepte strictement les dispositions du présent règlement, ainsi que les règlements spéciaux qui lui seront adressés dans les dossiers de l’exposant. Tout manquement à ces règlements par l’exposant peut entraîner son exclusion, sans que celui-ci ne puisse demander le remboursement des sommes versées ni d’indemnité de quelque nature que ce soit.
Produits exposés, exclusivités, fraudes, concurrence déloyale, contrefaçons : Les exposants s’engagent à ne présenter que des produits ou matériels conformes à la nomenclature établie par l’Organisateur et à la réglementation française, à ne procéder à aucune publicité susceptible d’induire en erreur ou de tromper le public et à ne commettre aucun acte de contrefaçon ou de concurrence déloyale.
Les circulaires, brochures, catalogues, imprimés, primes ou objets de toute nature ne pourront être distribués par les exposants que sur leur stand. Aucun prospectus relatif à des articles non-exposés ne pourra être distribué sans l’autorisation écrite et préalable de l’Organisateur. La distribution ou la vente de journaux, périodiques, prospectus, brochures, billets de tombola, insignes, bons de participation, etc., même si elle a trait à une œuvre ou manifestation de bienfaisance, les enquêtes dites de sondage, sont interdites à l’entrée du salon sauf dérogation accordée par l’Organisateur.
Les exposants s’engagent à ne présenter enfin que les fabrications ou services pour lesquels ils ont été admis à l’exposition. L’Organisateur peut à tout moment exiger que soient retirés immédiatement de l’exposition les objets litigieux. Le non-respect de ces obligations entraîne de plein droit l’exclusion temporaire ou définitive du salon. L’Organisateur peut interdire l’entrée de l’exposition à toute personne s’étant livrée à des actes préjudiciables à l’un des exposants.
L’exposant garantit l’Organisateur de tout recours, réclamation ou revendication de tiers fondées sur des faits de concurrence déloyale ou de contrefaçon et de façon générale sur l’atteinte à leurs droits des tiers par l’exposant et garantit l’Organisateur de tous dommages et intérêts et frais exposés en conséquence, en ce compris les honoraires d’avocat.
Installation des stands :
L’implantation des stands incombe à l’Organisateur. Les exposants peuvent aménager l’emplacement qui leur est alloué en tenant compte des impératifs suivants :
 - respecter les limites du stand attribué et ne pas empiéter sur les allées, respecter la hauteur limite des stands fixée à 2,5 m, sauf dérogation écrite.
 - respecter et ne pas modifier les éléments mis en place par l’Organisateur tels que : enseigne, moquette, éclairage, boîtier électrique, fluides.
 - s’assurer que tous les accessoires ajoutés par eux pour l’aménagement ou la décoration de leur stand sont ignifugés ou ininflammables, conformément à la réglementation en vigueur.
Ainsi l’exposant peut décorer son stand selon son goût dans le cadre des obligations précitées, après approbation de l’Organisateur de sa proposition de décoration. Toute infraction à cette obligation peut entraîner le démontage immédiat du stand. En cas d’infraction, l’exposant s’engage à faire déposer à ses frais et à ses risques et périls, les éléments en contravention avec le projet accepté ; à défaut, l’Organisateur se substitue à l’exposant, aux frais et sous la responsabilité de ce dernier.
L’approbation de l’Organisateur ne vaut pas validation de la décoration de l’exposant et ne saurait engager sa responsabilité. Cette approbation ne vaut que pour assurer une certaine homogénéité du salon et son image auprès du public. Toutes détériorations causées par les installations des exposants ou les marchandises exposées, aux installations fournies par l’Organisateur, au sol et locaux mis à leur disposition seront évaluées par les représentants de l’Organisation et facturées aux exposants responsables. L’installation des stands devra être terminée la veille de l’ouverture du salon en raison du contrôle de la Commission de Sécurité.
L’enceinte du salon sera interdite aux véhicules la veille et le jour de l’ouverture du salon et pendant la durée de l’exposition. L’Organisateur n’accordera de dérogation à cette règle que pour des motifs impérieux.
Jusqu’au déménagement complet des stands, il est fait obligation à tous les exposants de prévoir un responsable sur stand afin d’éviter notamment les vols.
Sécurité des produits et services :
Les produits ou services présentés sur les stands par les exposants doivent être conformes aux normes de sécurité en vigueur. Les exposants assument l’entière responsabilité des éventuelles défectuosités des dits produits ou services sans que la responsabilité de l’Organisateur ne puisse être recherchée.

7. ASSURANCES
L’organisateur décline toute responsabilité concernant les dommages de toute nature pouvant survenir aux biens exposés pour toutes causes que ce soit.
L’Organisateur a souscrit une assurance responsabilité civile en tant qu’Organisateur. Du seul fait de sa participation au salon, l’exposant ainsi que ses assureurs renoncent à tout recours, non seulement contre Porte du Hainaut Développement et/ou la CAPH et/ou la ville de Wallers, leurs personnels, leurs préposés ou toute personne sous leur garde. De son côté, l’Organisateur renonce également à tout recours contre les exposants, le cas de malveillance excepté. Les clauses de renonciation à recours visées au sein du présent article s’appliquent tant à l’Organisateur qu’à ses assureurs. Les exposants sont donc invités à se munir des assurances suivantes et d’en présenter l’attestation auprès du commissariat technique, lors de leur arrivée sur le site : une assurance à responsabilité civile à caractère obligatoire, avec clause de renonciation à recours envers Porte du Hainaut Développement et la commune de Wallers, une assurance facultative mais conseillée pour tout dommage (bris, vols, détérioration…) causé à leur matériel, comportant également une clause de renonciation à recours envers Porte du Hainaut Développement et la commune de Wallers.

8. SÉCURITÉ
Les produits ou services présentés sur les stands par les exposants doivent être conformes aux normes de sécurité en vigueur. Lors de la visite de la Commission de Sécurité, la veille ou le jour de l’ouverture du salon, l’exposant doit obligatoirement être présent sur le stand et être en mesure de fournir les procès-verbaux de réaction au feu de tous les matériaux utilisés.
Les exposants assument l’entière responsabilité des éventuelles défectuosités des dits produits ou services sans que la responsabilité de l’Organisateur puisse être recherchée. Le dossier de sécurité de la manifestation est assuré par un chargé de sécurité agréé par Porte du Hainaut Développement. En matière de sécurité, il est l’unique interlocuteur. C’est à lui qu’il faut adresser les demandes d’autorisation particulières concernant l’aménagement du stand par l’exposant.
L’utilisation de machines en fonctionnement, moteurs thermiques ou à combustion, liquides inflammables, générateurs de fumées, substances radioactives, rayons X, lasers fait l’objet d’une réglementation particulière. Idem, l’utilisation de drones volants fera l’objet d’une demande préalable.
L’exposant concerné s’oblige à prendre contact avec le chargé de sécurité agréé pour toute utilisation d’appareils précités.

9. LIMITATION DE RESPONSABILITÉ
L’Organisateur ne pourra en aucun cas être tenu responsable des dommages immatériels, indirects, accessoires ou spéciaux ou des dommages résultant d’une perte de profit, d’un manque à gagner, de privation d’usage subi par l’exposant ou par un tiers, et ce même si l’Organisateur est informé de la possible survenance de ces dommages. En cas de dommages directs, si la responsabilité de l’Organisateur était recherchée, celle-ci serait limitée à la somme versée pour l’admission de l’exposant.

10. PRESTATIONS EXCLUSIVES ET ENTREPRISES AGRÉÉES
Les prestations exclusives à Porte du Hainaut Développement sont : les fluides, la sécurité, le gardiennage, les télécommunications, l’accrochage des charges (cf. article 12), le chauffage et la climatisation, le nettoyage, l’accueil, le bar et la restauration générale.
Les entreprises agréées par l’organisateur sont seules habilitées à effectuer les travaux et à fournir le matériel dans le cadre du salon.L’exposant devra prendre soin du matériel mis à sa disposition, sous peine de supporter le coût du remplacement du matériel détérioré.

11. GUIDE DE L’EXPOSANT
Tous les renseignements concernant les détails de la participation de l’exposant au salon lui sont fournis dans le « Guide de l’Exposant », adressé à chaque participant après attribution des stands.

12. ACCROCHAGE DE CHARGES
Les accroches doivent obligatoirement faire l’objet de demande préalable circonstanciée auprès de Porte du Hainaut Développement. Pour des raisons de sécurité, l’exposant s’oblige à faire appel aux services de Porte du Hainaut Développement pour l’accrochage de charges à partir de la charpente du bâtiment.

13. RÉSISTANCE AU SOL
La résistance au sol est de 0,5 T / m². Il faut tenir compte de ces résistances non seulement pour l’installation du matériel exposé mais également pour les manutentions. Les surcharges ponctuelles et travaux lourds devront obtenir l’accord du service technique de Porte du Hainaut Développement. Les chariots et autres appareils de manutention doivent être équipés de roues à bandage caoutchouté.
L’exposant ne peut en aucun cas trouer les sols ou y fixer quoi que ce soit. Dans le cas contraire, toute dégradation des sols du fait de l’exposant est à la charge de l’exposant. Il lui appartient donc de prendre toutes mesures permettant d’assurer la protection des sols en cas de risque.

14. PARKING
Le stationnement aux abords du site de Wallers Arenberg est strictement réglementé. Le déchargement et chargement de matériel peuvent s’effectuer à partir de l’aire de livraison pour une durée limitée, suivant les directives qui seront appliquées par le service de sécurité.

15. NUISANCES ET ENVIRONNEMENT
L’exposant se doit d’avoir une attitude conforme aux intérêts généraux du salon et à l’image de l’Organisateur, notamment à l’égard des visiteurs et des autres participants. À ce titre, il s’engage en cas de litige ou de contestation avec l’Organisateur ou autres exposants, à ne rien faire qui puisse nuire au bon déroulement du salon. Toute attitude nuisible au bon déroulement du salon pourra entraîner l’exclusion immédiate de l’exposant. L’Organisateur se réserve le droit de faire enlever toute installation nuisant à l’aspect général du salon, ou tout matériel dégageant des odeurs nauséabondes, ou considéré comme dangereux. L’Organisateur en informera l’exposant avant d’y procéder.

16. ANIMAUX
L’introduction d’animaux est interdite dans l’enceinte du site de Wallers Arenberg.

17. STOCKAGE DES EMBALLAGES
Porte du Hainaut Développement ne dispose pas de locaux susceptibles d’entreposer les emballages vides pendant la période d’exposition. Ceux-ci doivent être emportés au fur et à mesure du montage par les exposants.

18. RÉCEPTION DES COLIS
Les colis envoyés par les exposants pourront être livrés au site de Wallers Arenberg pendant le montage, aux risques et périls de l’expéditeur, dans la mesure où le nom de l’exposition, celui de la société concernée, celui de son représentant et le numéro du stand seront clairement indiqués sur le colis. Les colis ne pourront être acceptés avant le montage (voir informations pratiques dans le « Guide de l’Exposant »)

19. CONTRÔLE DES ACCÈS
L’accès au site de Wallers Arenberg est réglementé par le service de sécurité pour les périodes de montage et de démontage et pour la durée de l’ouverture du salon. L’Organisateur se réserve le droit d’interdire l’accès au salon ou d’expulser toute personne dont l’attitude ou la tenue vestimentaire sera jugée incompatible avec l’image de marque de l’établissement et de la manifestation ou qui refuserait de se conformer au règlement de sécurité des lieux.

20. CLAUSE ATTRIBUTIVE DE JURIDICTION
En cas de difficulté d’interprétation du présent règlement et de litige pouvant surgir à l’occasion de la conclusion et de l’exécution du contrat, notamment pendant l’exposition, il est fait attribution expresse de compétence aux tribunaux de Valenciennes, et ce même en cas de pluralité de défendeurs ou d’appels de garantie.

21. OBLIGATIONS
L’exposant atteste sur l’honneur et certifie que le travail réalisé à cette occasion sera effectué par des salariés employés régulièrement au regard des articles L 143-3, L 143-5, L 341-6 et L 620-3 du code du travail. Les articles L 143-3 et L 143-5 du code du travail sont relatifs au mode de paiement du salarié : obligation de remettre un bulletin de salaire et de tenir un livre de paie. L’article L 341-6 du code du travail est relatif à l’interdiction de faire travailler un étranger non muni du titre l’autorisant à exercer une activité salariée en France. L’article L 620-3 est relatif à l’obligation de faire une déclaration préalable d’embauche à l’administration concernée et de tenir un registre des mouvements du personnel.
`;

    // Utilitaires
    function toNumber(value) {
      const n = parseFloat(value);
      return isNaN(n) ? 0 : n;
    }
    function formatEuros(value) {
      return value.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
    }

    // Calcule les totaux et met à jour l’interface
    function calculateTotals() {
      // Section 1
      const standEquipeSurface = toNumber(document.getElementById('standEquipeSurface').value);
      const standEquipeAngle = toNumber(document.getElementById('standEquipeAngle').value);
      const pack12 = toNumber(document.getElementById('pack12').value);
      const pack15 = toNumber(document.getElementById('pack15').value);
      const pack18 = toNumber(document.getElementById('pack18').value);
      const packAngles = toNumber(document.getElementById('packAngles').value);
      const standNuSurface = toNumber(document.getElementById('standNuSurface').value);
      const standNuAngle = toNumber(document.getElementById('standNuAngle').value);
      const puissanceValue = document.getElementById('puissance').value;
      const surfaceExt = toNumber(document.getElementById('surfaceExterieur').value);
      const cottage = toNumber(document.getElementById('cottage').value);
      // Calculs section 1
      const totStandEquipeSurface = standEquipeSurface * tarifs.standEquipeSurface;
      const totStandEquipeAngle = standEquipeAngle * tarifs.standEquipeAngle;
      const totPack12 = pack12 * tarifs.pack12;
      const totPack15 = pack15 * tarifs.pack15;
      const totPack18 = pack18 * tarifs.pack18;
      const totPackAngles = packAngles * tarifs.packAngle;
      const totStandNuSurface = standNuSurface * tarifs.standNuSurface;
      const totStandNuAngle = standNuAngle * tarifs.standNuAngle;
      const totPuissance = tarifs.puissance[puissanceValue] || 0;
      const totSurfaceExt = surfaceExt * tarifs.surfaceExterieur;
      const totCottage = cottage * tarifs.cottage;
      const totalSection1 = totStandEquipeSurface + totStandEquipeAngle + totPack12 + totPack15 + totPack18 + totPackAngles + totStandNuSurface + totStandNuAngle + totPuissance + totSurfaceExt + totCottage;
      // Mise à jour affichage section 1
      document.getElementById('tot_standEquipeSurface').textContent = formatEuros(totStandEquipeSurface);
      document.getElementById('tot_standEquipeAngle').textContent = formatEuros(totStandEquipeAngle);
      document.getElementById('tot_pack12').textContent = formatEuros(totPack12);
      document.getElementById('tot_pack15').textContent = formatEuros(totPack15);
      document.getElementById('tot_pack18').textContent = formatEuros(totPack18);
      document.getElementById('tot_packAngles').textContent = formatEuros(totPackAngles);
      document.getElementById('tot_standNuSurface').textContent = formatEuros(totStandNuSurface);
      document.getElementById('tot_standNuAngle').textContent = formatEuros(totStandNuAngle);
      document.getElementById('tot_surfaceExterieur').textContent = formatEuros(totSurfaceExt);
      document.getElementById('tot_cottage').textContent = formatEuros(totCottage);
      document.getElementById('totalSection1').textContent = formatEuros(totalSection1);
      // Section 2 : équipements stands
      const reserveMelamine = toNumber(document.getElementById('reserveMelamine').value);
      const moquetteDiff = toNumber(document.getElementById('moquetteDiff').value);
      const velum = toNumber(document.getElementById('velum').value);
      const cloisonBoisTissu = toNumber(document.getElementById('cloisonBoisTissu').value);
      const reserveBois = toNumber(document.getElementById('reserveBois').value);
      const railSpots = toNumber(document.getElementById('railSpots').value);
      const tot_reserveMelamine = reserveMelamine * tarifs.reserveMelamine;
      const tot_moquetteDiff = moquetteDiff * tarifs.moquetteDiff;
      const tot_velum = velum * tarifs.velum;
      const tot_cloisonBoisTissu = cloisonBoisTissu * tarifs.cloisonBoisTissu;
      const tot_reserveBois = reserveBois * tarifs.reserveBois;
      const tot_railSpots = railSpots * tarifs.railSpots;
      document.getElementById('tot_reserveMelamine').textContent = formatEuros(tot_reserveMelamine);
      document.getElementById('tot_moquetteDiff').textContent = formatEuros(tot_moquetteDiff);
      document.getElementById('tot_velum').textContent = formatEuros(tot_velum);
      document.getElementById('tot_cloisonBoisTissu').textContent = formatEuros(tot_cloisonBoisTissu);
      document.getElementById('tot_reserveBois').textContent = formatEuros(tot_reserveBois);
      document.getElementById('tot_railSpots').textContent = formatEuros(tot_railSpots);
      // Mobilier
      let totalMobilier = 0;
      mobilierKeys.forEach(key => {
        const input = document.getElementById('mobilier_' + key);
        if (input) {
          const qty = toNumber(input.value);
          const tot = qty * tarifs['mobilier_' + key];
          document.getElementById('tot_mobilier_' + key).textContent = formatEuros(tot);
          totalMobilier += tot;
        }
      });
      // Tot équipements stands
      const totalEquip = tot_reserveMelamine + tot_moquetteDiff + tot_velum + tot_cloisonBoisTissu + tot_reserveBois + tot_railSpots;
      const totalSection2 = totalEquip + totalMobilier;
      document.getElementById('totalSection2').textContent = formatEuros(totalSection2);
      // Section 3 : produits complémentaires
      const scanChecked = document.getElementById('scanBadges').checked;
      const passCount = toNumber(document.getElementById('passSoiree').value);
      const tot_scanBadges = scanChecked ? tarifs.scanBadges : 0;
      const tot_passSoiree = passCount * tarifs.passSoiree;
      document.getElementById('tot_scanBadges').textContent = formatEuros(tot_scanBadges);
      document.getElementById('tot_passSoiree').textContent = formatEuros(tot_passSoiree);
      const totalSection3 = tot_scanBadges + tot_passSoiree;
      document.getElementById('totalSection3').textContent = formatEuros(totalSection3);
      // Section 4 : visibilite & communication
      let totalVisu = 0;
      visukeys.forEach(key => {
        const qty = toNumber(document.getElementById('visu_' + key).value);
        const tot = qty * tarifs['visu_' + key];
        document.getElementById('tot_visu_' + key).textContent = formatEuros(tot);
        totalVisu += tot;
      });
      let totalAmeli = 0;
      amelikeys.forEach(key => {
        const qty = toNumber(document.getElementById('ameli_' + key).value);
        const tot = qty * tarifs['ameli_' + key];
        document.getElementById('tot_ameli_' + key).textContent = formatEuros(tot);
        totalAmeli += tot;
      });
      const totalSection4 = totalVisu + totalAmeli;
      document.getElementById('totalSection4').textContent = formatEuros(totalSection4);
      // Totaux généraux
      const totalHT = totalSection1 + totalSection2 + totalSection3 + totalSection4;
      const tva = totalHT * 0.20;
      const totalTTC = totalHT + tva;
      const acompte = totalTTC * 0.50;
      const solde = totalTTC - acompte;
      // Affichage dans la section Totaux
      document.getElementById('totalsDisplay').innerHTML = `
        <p>Total HT section 1 : <strong>${formatEuros(totalSection1)}</strong></p>
        <p>Total HT section 2 : <strong>${formatEuros(totalSection2)}</strong></p>
        <p>Total HT section 3 : <strong>${formatEuros(totalSection3)}</strong></p>
        <p>Total HT section 4 : <strong>${formatEuros(totalSection4)}</strong></p>
        <p><strong>Total HT général :</strong> ${formatEuros(totalHT)}</p>
        <p><strong>TVA 20 % :</strong> ${formatEuros(tva)}</p>
        <p><strong>Total TTC :</strong> ${formatEuros(totalTTC)}</p>
        <p><strong>Acompte (50 %) :</strong> ${formatEuros(acompte)}</p>
        <p><strong>Solde :</strong> ${formatEuros(solde)}</p>
      `;
      // Activation du bouton
      const ready = document.getElementById('acceptReglement').checked && document.getElementById('nomSignataire').value.trim() !== '' && document.getElementById('dateSignature').value !== '';
      document.getElementById('generatePdf').disabled = !ready;
    }

    // Collecte des prestations sélectionnées pour le devis
    function collectPrestations() {
      const prestations = [];
      function addPrestation(libelle, qty, unite, pu) {
        const q = parseFloat(qty);
        if (!q || q <= 0) return;
        prestations.push({ libelle: libelle, qty: q, unite: unite, pu: pu, total: q * pu });
      }
      // Stands
      addPrestation('Stand équipé', document.getElementById('standEquipeSurface').value, 'm²', tarifs.standEquipeSurface);
      addPrestation('Angle stand équipé', document.getElementById('standEquipeAngle').value, 'angle', tarifs.standEquipeAngle);
      addPrestation('Pack 12 m²', document.getElementById('pack12').value, 'pack', tarifs.pack12);
      addPrestation('Pack 15 m²', document.getElementById('pack15').value, 'pack', tarifs.pack15);
      addPrestation('Pack 18 m²', document.getElementById('pack18').value, 'pack', tarifs.pack18);
      addPrestation('Angles pack', document.getElementById('packAngles').value, 'angle', tarifs.packAngle);
      addPrestation('Stand nu', document.getElementById('standNuSurface').value, 'm²', tarifs.standNuSurface);
      addPrestation('Angle stand nu', document.getElementById('standNuAngle').value, 'angle', tarifs.standNuAngle);
      const puissanceVal = document.getElementById('puissance').value;
      if (puissanceVal !== '0') {
        addPrestation('Puissance électrique ' + puissanceVal + ' €', 1, '', tarifs.puissance[puissanceVal]);
      }
      addPrestation('Surface exposition extérieure', document.getElementById('surfaceExterieur').value, 'm²', tarifs.surfaceExterieur);
      addPrestation('Garden cottage', document.getElementById('cottage').value, '', tarifs.cottage);
      // Équipements stands
      addPrestation('Réserve 1 m² mélaminé', document.getElementById('reserveMelamine').value, '', tarifs.reserveMelamine);
      addPrestation('Moquette coloris différent', document.getElementById('moquetteDiff').value, 'm²', tarifs.moquetteDiff);
      addPrestation('Velum tissu', document.getElementById('velum').value, 'm²', tarifs.velum);
      addPrestation('Cloison bois gainée tissu', document.getElementById('cloisonBoisTissu').value, 'ml', tarifs.cloisonBoisTissu);
      addPrestation('Réserve 1 m² bois', document.getElementById('reserveBois').value, '', tarifs.reserveBois);
      addPrestation('Rail de 3 spots supplémentaires', document.getElementById('railSpots').value, '', tarifs.railSpots);
      // Mobilier
      mobilierKeys.forEach(key => {
        const input = document.getElementById('mobilier_' + key);
        if (input) {
          addPrestation('Mobilier : ' + key.replace(/([A-Z])/g, ' $1'), input.value, '', tarifs['mobilier_' + key]);
        }
      });
      // Produits complémentaires
      if (document.getElementById('scanBadges').checked) {
        addPrestation('Scan badges visiteurs', 1, '', tarifs.scanBadges);
      }
      addPrestation('Pass soirée', document.getElementById('passSoiree').value, 'pass', tarifs.passSoiree);
      // Visibilité / signalétique
      visukeys.forEach(key => {
        addPrestation('Signalétique : ' + key.replace(/([A-Z])/g, ' $1'), document.getElementById('visu_' + key).value, '', tarifs['visu_' + key]);
      });
      amelikeys.forEach(key => {
        addPrestation('Visibilité : ' + key.replace(/([A-Z])/g, ' $1'), document.getElementById('ameli_' + key).value, '', tarifs['ameli_' + key]);
      });
      return prestations;
    }

    // Génération du devis PDF et envoi des données
    async function generatePdf() {
      // Recalcule les totaux pour garantir des valeurs à jour
      calculateTotals();
      const signataire = document.getElementById('nomSignataire').value.trim();
      const date = document.getElementById('dateSignature').value;
      const raisonSociale = document.getElementById('raisonSociale').value.trim();
      const adresse = document.getElementById('adresse').value.trim();
      const codePostal = document.getElementById('codePostal').value.trim();
      const ville = document.getElementById('ville').value.trim();
      const pays = document.getElementById('pays').value.trim();
      const telephone = document.getElementById('telephone').value.trim();
      const email = document.getElementById('contactMail').value.trim();
      // Collecte des prestations et calcul du total HT
      const prestations = collectPrestations();
      let totalHT = 0;
      prestations.forEach(item => { totalHT += item.total; });
      // Montant de la TVA calculé sur le total HT
      const tvaAmount = totalHT * 0.20;
      const totalTTC = totalHT + tvaAmount;
      const acompte = totalTTC * 0.50;
      const solde = totalTTC - acompte;
      // Prépare un objet de données exhaustif pour le Google Sheet
      const activites = [];
      if (document.getElementById('actIndustrie').checked) activites.push('Industrie');
      if (document.getElementById('actEnvironnement').checked) activites.push('Environnement');
      if (document.getElementById('actTourisme').checked) activites.push('Tourisme');
      if (document.getElementById('actTransport').checked) activites.push('Transport');
      if (document.getElementById('actServices').checked) activites.push('Services');
      if (document.getElementById('actBTP').checked) activites.push('BTP');
      if (document.getElementById('actImage').checked) activites.push('Image');
      if (document.getElementById('actAutre').checked) activites.push('Autre');
      // Quantités section 1
      const s1_standEquipeSurface = parseFloat(document.getElementById('standEquipeSurface').value) || 0;
      const s1_standEquipeAngle = parseFloat(document.getElementById('standEquipeAngle').value) || 0;
      const s1_pack12 = parseFloat(document.getElementById('pack12').value) || 0;
      const s1_pack15 = parseFloat(document.getElementById('pack15').value) || 0;
      const s1_pack18 = parseFloat(document.getElementById('pack18').value) || 0;
      const s1_packAngles = parseFloat(document.getElementById('packAngles').value) || 0;
      const s1_standNuSurface = parseFloat(document.getElementById('standNuSurface').value) || 0;
      const s1_standNuAngle = parseFloat(document.getElementById('standNuAngle').value) || 0;
      const s1_puissance = document.getElementById('puissance').value;
      const s1_surfaceExt = parseFloat(document.getElementById('surfaceExterieur').value) || 0;
      const s1_cottage = parseFloat(document.getElementById('cottage').value) || 0;
      // Section 2 quantités
      const s2_reserveMelamine = parseFloat(document.getElementById('reserveMelamine').value) || 0;
      const s2_moquetteDiff = parseFloat(document.getElementById('moquetteDiff').value) || 0;
      const s2_velum = parseFloat(document.getElementById('velum').value) || 0;
      const s2_cloisonBoisTissu = parseFloat(document.getElementById('cloisonBoisTissu').value) || 0;
      const s2_reserveBois = parseFloat(document.getElementById('reserveBois').value) || 0;
      const s2_railSpots = parseFloat(document.getElementById('railSpots').value) || 0;
      const mobilierQuantities = {};
      mobilierKeys.forEach(k => {
        const val = parseFloat(document.getElementById('mobilier_' + k).value) || 0;
        mobilierQuantities[k] = val;
      });
      // Section 3
      const s3_scanBadges = document.getElementById('scanBadges').checked ? 1 : 0;
      const s3_passSoiree = parseFloat(document.getElementById('passSoiree').value) || 0;
      // Section 4
      const visuelQuantities = {};
      visukeys.forEach(k => {
        visuelQuantities[k] = parseFloat(document.getElementById('visu_' + k).value) || 0;
      });
      const ameliQuantities = {};
      amelikeys.forEach(k => {
        ameliQuantities[k] = parseFloat(document.getElementById('ameli_' + k).value) || 0;
      });
      // Recalcule des sous-totaux par section (identique à calculateTotals)
      const tot_s1 = s1_standEquipeSurface * tarifs.standEquipeSurface +
        s1_standEquipeAngle * tarifs.standEquipeAngle +
        s1_pack12 * tarifs.pack12 + s1_pack15 * tarifs.pack15 + s1_pack18 * tarifs.pack18 +
        s1_packAngles * tarifs.packAngle + s1_standNuSurface * tarifs.standNuSurface + s1_standNuAngle * tarifs.standNuAngle +
        (tarifs.puissance[s1_puissance] || 0) + s1_surfaceExt * tarifs.surfaceExterieur + s1_cottage * tarifs.cottage;
      const tot_s2_equip = s2_reserveMelamine * tarifs.reserveMelamine + s2_moquetteDiff * tarifs.moquetteDiff +
        s2_velum * tarifs.velum + s2_cloisonBoisTissu * tarifs.cloisonBoisTissu + s2_reserveBois * tarifs.reserveBois + s2_railSpots * tarifs.railSpots;
      let tot_s2_mobilier = 0;
      mobilierKeys.forEach(k => {
        tot_s2_mobilier += mobilierQuantities[k] * tarifs['mobilier_' + k];
      });
      const tot_s2 = tot_s2_equip + tot_s2_mobilier;
      const tot_s3 = (s3_scanBadges ? tarifs.scanBadges : 0) + s3_passSoiree * tarifs.passSoiree;
      let tot_s4_visu = 0;
      visukeys.forEach(k => { tot_s4_visu += visuelQuantities[k] * tarifs['visu_' + k]; });
      let tot_s4_ameli = 0;
      amelikeys.forEach(k => { tot_s4_ameli += ameliQuantities[k] * tarifs['ameli_' + k]; });
      const tot_s4 = tot_s4_visu + tot_s4_ameli;
      // Objet de données final pour Google Sheet
      const data = {
        date,
        signataire,
        raisonSociale,
        adresse,
        codePostal,
        ville,
        pays,
        telephone,
        fax: document.getElementById('fax').value.trim(),
        siteInternet: document.getElementById('siteInternet').value.trim(),
        siret: document.getElementById('siret').value.trim(),
        // Numéro de TVA intracommunautaire saisi dans le formulaire. Pour éviter toute confusion avec le montant de la TVA
        // calculée sur le devis, on l'enregistre dans plusieurs propriétés : `tvaNumber` et `tvaIntracommunautaire`.
        tvaNumber: document.getElementById('tva').value.trim(),
        tvaIntracommunautaire: document.getElementById('tva').value.trim(),
        membrePorte: document.getElementById('membrePorte').checked ? 'Oui' : 'Non',
        exposant2024: document.getElementById('exposant2024').checked ? 'Oui' : 'Non',
        activites: activites.join(', '),
        factCodePostal: document.getElementById('factCodePostal').value.trim(),
        factVille: document.getElementById('factVille').value.trim(),
        factPays: document.getElementById('factPays').value.trim(),
        contactNom: document.getElementById('contactNom').value.trim(),
        contactTel: document.getElementById('contactTel').value.trim(),
        contactMail: email,
        respNom: document.getElementById('respNom').value.trim(),
        respPrenom: document.getElementById('respPrenom').value.trim(),
        respTel: document.getElementById('respTel').value.trim(),
        respMail: document.getElementById('respMail').value.trim(),
        opNom: document.getElementById('opNom').value.trim(),
        opPrenom: document.getElementById('opPrenom').value.trim(),
        opTel: document.getElementById('opTel').value.trim(),
        opMail: document.getElementById('opMail').value.trim(),
        enseigne: document.getElementById('enseigne').value.trim(),
        // Section 1
        standEquipeSurface: s1_standEquipeSurface,
        standEquipeAngle: s1_standEquipeAngle,
        pack12: s1_pack12,
        pack15: s1_pack15,
        pack18: s1_pack18,
        packAngles: s1_packAngles,
        standNuSurface: s1_standNuSurface,
        standNuAngle: s1_standNuAngle,
        puissance: s1_puissance,
        surfaceExterieur: s1_surfaceExt,
        cottage: s1_cottage,
        // Section 2 équipements
        reserveMelamine: s2_reserveMelamine,
        moquetteDiff: s2_moquetteDiff,
        velum: s2_velum,
        cloisonBoisTissu: s2_cloisonBoisTissu,
        reserveBois: s2_reserveBois,
        railSpots: s2_railSpots,
        mobilier: mobilierQuantities,
        // Section 3
        scanBadges: s3_scanBadges,
        passSoiree: s3_passSoiree,
        // Section 4
        signaletique: visuelQuantities,
        communication: ameliQuantities,
        // Totaux par section et général
        totalSection1: tot_s1.toFixed(2),
        totalSection2: tot_s2.toFixed(2),
        totalSection3: tot_s3.toFixed(2),
        totalSection4: tot_s4.toFixed(2),
        totalHT: totalHT.toFixed(2),
        // Montant de TVA calculé sur le devis (au format string, deux décimales)
        tvaAmount: tvaAmount.toFixed(2),
        // Alias pour le montant de TVA (certaines versions de script Apps utilisent simplement "tva")
        tva: tvaAmount.toFixed(2),
        totalTTC: totalTTC.toFixed(2),
        acompte: acompte.toFixed(2),
        solde: solde.toFixed(2),
        prestations
      };
      // Envoi des données au Google Sheet
      sendDataToSheet(data);
      // Génère les deux documents PDF puis crée une archive zip
      try {
        const quoteDoc = await createQuoteDoc({
          raisonSociale,
          date,
          adresse,
          codePostal,
          ville,
          pays,
          telephone,
          email,
          signataire,
        }, prestations, totalHT, tvaAmount, totalTTC, acompte, solde);
        const contractDoc = await createContractDoc(data);
        const quoteName = 'Devis MIH 2026 "' + raisonSociale.replace(/\s+/g, '_') + '".pdf';
        const contractName = 'Contrat MIH 2026 ' + (raisonSociale || '').replace(/\s+/g, '_') + '.pdf';
        const quoteBlob = quoteDoc.output('blob');
        const contractBlob = contractDoc.output('blob');
        const zip = new JSZip();
        zip.file(quoteName, quoteBlob);
        zip.file(contractName, contractBlob);
        const zipBlob = await zip.generateAsync({ type: 'blob' });
        const zipFileName = 'Devis_et_Contrat_MIH_2026_' + raisonSociale.replace(/\s+/g, '_') + '.zip';
        const url = URL.createObjectURL(zipBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = zipFileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      } catch (err) {
        console.error('Erreur lors de la génération des fichiers PDF :', err);
        // Si jsPDF ou JSZip est indisponible, fallback imprimable pour le devis uniquement
        let html = '<html><head><title>Devis</title></head><body style="font-family:Arial, sans-serif;">';
        html += '<h2>Devis MIH 2026 – ' + raisonSociale + '</h2>';
        html += '<p>Date : ' + date.split('-').reverse().join('/') + '</p>';
        html += '<p>Raison sociale : ' + raisonSociale + '</p>';
        html += '<p>Adresse : ' + adresse + ', ' + codePostal + ' ' + ville + ' ' + pays + '</p>';
        html += '<p>Téléphone : ' + telephone + ' | Email : ' + email + '</p>';
        html += '<h3>Détails des prestations sélectionnées</h3>';
        html += '<table border="1" cellspacing="0" cellpadding="4"><tr><th>Libellé</th><th>Qté</th><th>PU HT</th><th>Total HT</th></tr>';
        prestations.forEach(item => {
          html += '<tr><td>' + item.libelle + '</td><td>' + item.qty + '</td><td>' + formatEuros(item.pu) + '</td><td>' + formatEuros(item.total) + '</td></tr>';
        });
        html += '</table>';
        html += '<h3>Résumé financier</h3>';
        html += '<p>Total HT : ' + formatEuros(totalHT) + '</p>';
        html += '<p>TVA 20 % : ' + formatEuros(tva) + '</p>';
        html += '<p>Total TTC : ' + formatEuros(totalTTC) + '</p>';
        html += '<p>Acompte (50 %) : ' + formatEuros(acompte) + '</p>';
        html += '<p>Solde : ' + formatEuros(solde) + '</p>';
        html += '<p>Signature : ' + signataire + '</p>';
        html += '</body></html>';
        const printWindow = window.open('', '_blank');
        printWindow.document.write(html);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
      }
    }

    // Envoi vers Google Sheets. Remplacez l’URL par celle de votre script Apps Script.
    function sendDataToSheet(data) {
      // URL du script Apps Script fourni par l’utilisateur pour l’envoi des données
      // Remplacez cette URL si vous déployez un nouveau script
      const url = 'https://script.google.com/macros/s/AKfycbwAYZRquP5OEfrM1sL0oCbqfpXPftqodwLCwzukldsbjwmDlzfRz9gIXOIzih2yJy6Q/exec';
      try {
        fetch(url, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
      } catch (e) {
        console.error('Erreur lors de l’envoi des données vers Google Sheets', e);
      }
    }

    // Gestion des évènements
    document.querySelectorAll('#contractForm input, #contractForm select').forEach(el => {
      el.addEventListener('input', calculateTotals);
      el.addEventListener('change', calculateTotals);
    });
    document.getElementById('generatePdf').addEventListener('click', generatePdf);
    // Calcul initial
    calculateTotals();

    // Initialise le modal des conditions générales une fois le DOM chargé
    document.addEventListener('DOMContentLoaded', () => {
      // Insère le texte des conditions dans le bloc <pre>
      const pre = document.getElementById('conditionsText');
      if (pre) {
        pre.textContent = conditionsContent;
      }
      // Affiche le modal au clic sur le libellé des conditions
      const trigger = document.getElementById('showConditions');
      if (trigger) {
        trigger.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          document.getElementById('conditionsModal').style.display = 'block';
        });
      }
      // Bouton de fermeture du modal
      const btnClose = document.getElementById('closeConditions');
      if (btnClose) {
        btnClose.addEventListener('click', () => {
          document.getElementById('conditionsModal').style.display = 'none';
        });
      }
    });
  </script>
</body>
</html>